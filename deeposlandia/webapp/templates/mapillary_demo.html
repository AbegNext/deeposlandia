{% extends 'layout.html' %}

{% block content %}

<script>
  const dataset = "mapillary";
  const model = "{{ model }}";
</script>

<h2>Deep learning predictor: {{model}} for Mapillary dataset</h2>

<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"
        aria-current="page"><a href="{{url_for('index')}}">Home</a>
    </li>
  </ol>
</nav>

<h4>Description</h4>

<p>
  In the <a href="https://www.mapillary.com/dataset/vistas">Mapillary</a> dataset, there are 65
  labels, and consequently the model aims at answering one question for each: <em>is this label on
  the picture?</em> We could get as a result a vector of 65 boolean values.
</p>

<p>The dataset glossary is subdivided into 7 larger classes. For a sake of clarity, a lighter
  classification with only 13 labels has been built up:
  <ul>
    <li>animal: ground animal or birds</li>
    <li>construction (barrier): curbs, fences, guard rails and other barriers</li>
    <li>construction (flat): ground areas like roads, parkings, bike lanes...</li>
    <li>construction (structure): buildings, bridges, tunnels</li>
    <li>human</li>
    <li>rider: human on a bike, a motorbike or a horse</li>
    <li>marking</li>
    <li>nature: mountain, sand, sky, vegetation</li>
    <li>traffic-sign</li>
    <li>support: pole, traffic-sign frame, utility pole</li>
    <li>vehicule</li>
    <li>object: miscellaneous objects</li>
    <li>void: own vehicle or unlabeled pixels</li>
  </ul>
</p>

<h4>Remark about model training</h4>

<p>
  The trained neural network has a <a href="https://arxiv.org/pdf/1505.04597.pdf">U-net
  architecture</a>. It has been trained during 20 epochs with a set of 18000 training images and
  validated with a smaller set of 2000 images (the validation occurred at the end of each training
  epoch), in order to ensure that learned features are as generic as possible.
</p>

<h4>Use the deep learning model to predict image labels</h4>

<p>Click on the below button to generate a random picture from Mapillary
dataset, and to display the corresponding label predictions.</p>

<button id="predict_labels" value="Generate a new image" dataset="mapillary">Generate a new image</button>
<br>
<div class="mapillaryContainer">
  <div class="column column-left">
    <label>Raw image</label>
    <br>
    <img id="raw_image" height="400" width="400" src="{{url_for('static', filename=image_filename)}}">
  </div>
  <div class="column column-center">
    <label>Ground-truth</label>
    <br>
    <img id="ground_truth" height="400" width="400" src="{{url_for('static', filename=label_filename)}}">
    <br>
    <span id="ground_truth_labels"> {{ ground_truth|safe }} </span>
  </div>
  <div class="column column-right">
    <label>Prediction</label>
    <br>
    <img id="predictions" height="400" width="400" src="{{url_for('static', filename=predicted_filename)}}">
    <br>
    <span id="result"> {{ result|safe }} </span>
  </div>
</div>

{% endblock %}

{% block appjs %}

<script src="{{ url_for('static', filename='demo_predictor.js') }}" type="text/javascript"></script>

{% endblock %}
